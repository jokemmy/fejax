!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("whatitis")):"function"==typeof define&&define.amd?define(["whatitis"],e):t.fejax=e(t.is)}(this,function(t){"use strict";var m="default"in t?t.default:t,g=function(t,e){if((null==(n=t)||"object"!=typeof n||!1!==Array.isArray(n))&&"function"!=typeof t)return{};var n,r={};if("string"==typeof e)return e in t&&(r[e]=t[e]),r;for(var o=e.length,a=-1;++a<o;){var i=e[a];i in t&&(r[i]=t[i])}return r},b=function(t,e,n,r,o,a,i,u){if(!t){var c;if(void 0===e)c=Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var s=[n,r,o,a,i,u],l=0;(c=Error(e.replace(/%s/g,function(){return s[l++]}))).name="Invariant Violation"}throw c.framesToPop=1,c}};function w(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];if(0===e.length)return function(t){return t};if(1===e.length)return e[0];var r=e[e.length-1],o=e.slice(0,-1);return function(){return o.reduceRight(function(t,e){return e(t)},r.apply(void 0,arguments))}}var l=function(t,e){var n=void 0;switch(t){case"json":if(e.length)try{n="JSON"in global?JSON.parse(e):Function("return ("+e+")")()}catch(t){throw Error("Hope: Error while parsing JSON body : "+t)}break;case"xml":try{window.DOMParser?n=(new DOMParser).parseFromString(e,"text/xml"):((n=new window.ActiveXObject("Microsoft.XMLDOM")).async="false",n.loadXML(e))}catch(t){n=void 0}if(!n||!n.documentElement||n.getElementsByTagName("parsererror").length)throw Error("Hope: Invalid XML");break;default:n=e}return n},e=function(){function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}}(),j=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t},T=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,o=!1,a=void 0;try{for(var i,u=t[Symbol.iterator]();!(r=(i=u.next()).done)&&(n.push(i.value),!e||n.length!==e);r=!0);}catch(t){o=!0,a=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw a}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},O=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)},x={TEXT:"*/*",XML:"text/xml",JSON:"application/json",POST:"application/x-www-form-urlencoded",DOCUMENT:"text/html"},u={TEXT:"*/*",XML:"application/xml; q=1.0, text/xml; q=0.8, */*; q=0.1",JSON:"application/json; q=1.0, text/*; q=0.8, */*; q=0.1"};function c(e){return function(t){return Object.keys(t).some(function(t){return t.toLowerCase()===e.toLowerCase()})}}function r(t){return encodeURIComponent(t)}function E(t){return m.PlainObject(t)?Object.keys(n=t).reduce(function(t,e){return(t?t+"&":"")+r(e)+"="+r(n[e])},""):t;var n}function A(e,t){var n,r,o=t.headers,a=t.method,i=t.dataType.toUpperCase();n=o,c("accept")(n)||(o.Accept=u[i]||u.TEXT),r=o,c("content-type")(r)||"get"===a||(o["Content-Type"]=x.POST),Object.keys(o).forEach(function(t){o[t]&&e.setRequestHeader(t,o[t])})}function _(r){return function(t,e){return e(r||(-1<(n=t.getResponseHeader("Content-Type")).indexOf(x.JSON)?"json":-1<n.indexOf(x.XML)?"xml":"text"),t.response);var n}}function M(a,i,u,c,s){return function t(e){if(s.readyState===s.DONE){c&&clearTimeout(c),a||i?(s.onload=null,s.onerror=null):s.removeEventListener?s.removeEventListener("readystatechange",t,!1):s.onreadystatechange=null;var n=function(t,e,n){var r=n,o=null,a=null;if(void 0!==t.response||void 0!==t.responseType&&""!==t.responseType&&"text"!==t.responseType||(t.response=t.responseText),n)try{m.Function(e)?o=e(t,l):null===t.response?(r=!1,a="parseerror"):o=t.response}catch(t){r=!1,a="parseerror"}else a=t.statusText;return{success:r,result:o,error:a}}(s,u,200<=s.status&&s.status<300||304===s.status),r=n.result,o=n.error;n.success?e.then&&e.then(r,s):e.catch&&e.catch(o,s),e.finally&&e.finally(o,r,s)}}}var L=void 0;try{if(m.Undefined(window))throw Error("Hope: Ajax only for browser environment.");L=window.XMLHttpRequest?function(){return new window.XMLHttpRequest}:function(){return new window.ActiveXObject("Microsoft.XMLHTTP")}}catch(t){L=function(){}}function n(t,e,n,r){var o=void 0,a="",i={},u=["then","catch","finally"].reduce(function(n,r){return n[r]=function(t){var e=i[r];return i[r]=e?w(t,e):t,n},n},{}),c=function(t,e){var n=void 0,r=!1,o=""===t.responseType;if(e.crossOrigin){if(!o&&window.XDomainRequest)return n=new window.XDomainRequest,r=!0,"get"!==e.method&&"post"!==e.method&&(e.method="post"),[n,r,o];throw Error("Hope: CrossOrigin is not support.")}return[t,r,o]}(L(),r),s=T(c,3),l=s[0],f=s[1],d=s[2];"get"===t&&n&&(a="?"+E(n)),f?l.open(t,e+a):l.open(t,e+a,r.async,r.user,r.password),d&&(l.withCredentials=!(!r.async&&!r.withCredentials)),"setRequestHeader"in l&&A(l,r);var h,p,y=void 0,v=void 0,m=function(){l.statusText_="timeout",(r.ontimeout||v)()};if(r.async?d?(l.timeout=r.timeout,l.ontimeout=m):y=setTimeout((h=l,p=m,function(){h.aborted||(h.abort(),p&&p(h))}),r.timeout):f&&(l.ontimeout=function(){}),d)try{l.responseType=r.dataType,o=d&&l.responseType===r.dataType}catch(t){}else"overrideMimeType"in l&&l.overrideMimeType(x[r.dataType.toUpperCase()]);var g=o||_(r.dataType),b=function(){return M(d,f,g,y,l)(i)};return v=b,d||f?(l.onload=b,l.onerror=b,l.onabort=b,f&&(l.onprogress=function(){})):l.addEventListener?l.addEventListener("readystatechange",b,!1):l.onreadystatechange=b,l.send("get"!==t?E(n):null),u.abort=function(){l.aborted||(y&&clearTimeout(y),l.aborted=!0,l.abort())},u}var v={method:"get",headers:{"X-Requested-With":"XMLHttpRequest"},timeout:1e4,ontimeout:null,baseUrl:"",data:null,url:"",withCredentials:!1,crossDomain:!1,user:"",password:"",dataType:"json",cache:!1};var S=w(function(t){return n(t.method,t.baseUrl+t.url,t.data,t)},function(t){var e=t.method,n=t.headers,r=t.timeout,o=t.ontimeout,a=t.baseUrl,i=t.data,u=t.url,c=t.withCredentials,s=t.crossDomain,l=t.user,f=t.password,d=t.dataType,h=t.cache,p=Object.assign({},v);if(p.headers=Object.assign({},p.headers),m.String(e)&&e&&(p.method=e),m.PlainObject(n)&&Object.assign(p.headers,n),m.Number(r)&&isFinite(r)&&(p.timeout=Math.max(0,r)),m.Function(o)&&(p.ontimeout=o),m.String(a)&&a&&(p.baseUrl=a),i&&(p.data=m.PlainObject(i)?Object.assign({},i):i),m.String(u)&&u&&(p.url=u),p.withCredentials=!!c,p.crossDomain=!!s,p.crossDomain||"XMLHttpRequest"!==p.headers["X-Requested-With"]||delete p.headers["X-Requested-With"],m.String(l)&&l&&(p.user=l,m.String(f)&&(p.password=f)),Object.keys(x).includes(d.toUpperCase())&&(p.dataType=d),"ArrayBuffer"in window&&i instanceof ArrayBuffer?p.dataType="arraybuffer":"Blob"in window&&i instanceof Blob?p.dataType="blob":"Document"in window&&i instanceof Document?p.dataType="document":"FormData"in window&&i instanceof FormData&&(p.dataType="json"),m.Object(n)){var y=n["Cache-Control"];h||m.String(y)||!y||(p.headers["Cache-Control"]="no-cache")}return p.async=!0,b(p.url||p.baseUrl,"Hope: One of Url and BaseUrl must be a non-empty string."),p}),s="PENDING",o="FULFILLED",a="REJECTED";function i(t,e){t._state=e}function f(t){return 1<t.length?t:t[0]}function d(t){return function(e){try{return i(e.chain,e.err?a:o),t(e)}catch(t){throw e.err=t,e.result=[t],i(e.chain,a),t}}}function h(t){return function(e){try{return t(e)}catch(t){return Object.assign(e,{err:t,result:[t]})}}}function p(t){return function(e){try{return t(e)}catch(t){var n=setTimeout(function(){throw t});return Object.assign(e,{err:t,timer:n,result:[t]})}}}function y(e){return function(t){if(e.apply(void 0,[t.err||null,t.err?null:t.result].concat(O(t.argument))),t.err)throw t.err;return t}}function X(e){return function(t){return e.apply(void 0,[t.err||null,t.err?null:t.result].concat(O(t.argument))),t}}function D(n){return function(t){var e=Object.assign({},t);return e.err||(e.result=m.Defined(e.result)?n(e.result):n.apply(void 0,O(e.argument))),e}}function R(n){return function(t){var e=Object.assign({},t);return e.err?(e.timer&&(clearTimeout(e.timer),delete e.timer),e.result=n(e.err),Object.assign(e,{err:null})):e}}var U={thenMethod:function(t,e){var n=w(d,D)(e);return t?w(n,t):n},catchMethod:function(t,e){var n=w(R)(e);return t?w(n,h(t)):n},alwaysMethod:function(t,e){var n=w(y)(e);return t?w(n,h(t)):n},thenSyncMethod:function(t){return w(p,d,D)(t)},catchSyncMethod:function(t){return w(p,R)(t)},alwaysSyncMethod:function(t){return w(p,X)(t)}};function C(t){setTimeout(function(){delete t._sync})}var F=function(){function u(t){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),this._result=null,this._state=s;var r,o=null,e=(b(m.Function(r=t),"Hope: You must pass a resolver function as the first argument to the chain constructor"),function(t,e){try{r(t,e)}catch(t){e(t)}});["resolve","reject"].forEach(function(t){var r=n[t].bind(n);n[t]=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return r.apply(void 0,[o].concat(e))}}),["then","catch","always"].forEach(function(e){n[e]=function(t){return n._sync?(n._set=U[e+"SyncMethod"](t)(n._set),n._result=n._set.result):o=U[e+"Method"](o,t),n}});var a=this.then,i=this.catch;this.then=function(t,e){return m.Function(t)&&a(t),m.Function(e)&&i(e),n},e(this.resolve,this.reject)}return e(u,null,[{key:"of",value:function(t){return new u(t)}},{key:"resolve",value:function(e){return u.of(function(t){return t(e)})}},{key:"reject",value:function(n){return u.of(function(t,e){return e(n)})}},{key:"all",value:function(t){var n=u.of(function(){}),e=Array.from(t);return e.forEach(function(t){t.always(function(){return function(t){if(t.every(function(t){return t._state!==s})){var e=t.map(function(t){return t._result});t.some(function(t){return t._state===a})&&n.reject.apply(n,O(e)),n.resolve.apply(n,O(e))}}(e)}).catch(function(){})}),n}},{key:"race",value:function(t){var n=u.of(function(){}),e=Array.from(t);return e.forEach(function(t){t.always(function(){return function(t){if(t.some(function(t){return t._state!==s})){var e=t.find(function(t){return t._state!==s});e._state===a&&n.reject(e._result),n.resolve(e._result)}}(e)}).catch(function(){})}),n}}]),e(u,[{key:"resolve",value:function(t){for(var e=arguments.length,n=Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return this._state===s&&(this._result=f(n),this._state=o,this._set={err:null,result:void 0,argument:n,chain:this},t?this._set=t(this._set):(C(this),this._sync=!0)),this}},{key:"reject",value:function(t){for(var e=arguments.length,n=Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return this._state===s&&(this._result=f(n),this._state=a,this._set={err:n,result:void 0,argument:n,chain:this},t?this._set=t(this._set):(C(this),this._sync=!0)),this}}]),u}(),k=process&&!1;var q=Symbol("ajax"),H=Symbol("ajaxHandler"),P=t.property(q),N={urls:{},tokens:new Map,setURLTokens:function(t){var o=N.tokens;Object.entries(t).forEach(function(t){var e=T(t,2),n=e[0],r=e[1];o.set(n,[RegExp("{"+n+"}","g"),r])})},setURLAlias:function(t,e){var n=N.urls;Object.entries(t).forEach(function(t){var e=T(t,2);n[e[0]]=e[1]}),m.Function(e)&&(N.URLTransform=e)},setDataTransform:function(t){m.Function(t)&&(N.dataTransform=t)},setAssert:function(t){m.Function(t)&&(N.assert=t)},URLTransform:function(t,e){var o=N.urls[t];return o?(e.forEach(function(t){var e=T(t,2),n=e[0],r=e[1];n.test(o)&&(o=o.replace(n,r))}),o):t},dataTransform:function(t,e,n,r){return e||n},assert:function(t,e,n,r){n(e)}},J=function(i,u,c){return function(a){return function(t,e){var n=c.dataType,r=N.dataTransform;if(a)m.Function(c.assert)?c.assert(n,r(n,t,null,e),i,u):N.assert(n,r(n,t,null,e),i,u);else if(0===e.status){var o=e.aborted?"abort":"timeout";!function(t,e){var n,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"";k&&("undefined"==typeof window?console.log("Hope: "+e+"\n"+(r&&r.stack||r)):(n=console)[t].apply(n,O([e].concat(r?["\n",r]:[]))))}("warn","Url ("+c.url+") is "+o+"."),u(r(n,null,o,e))}else u(r(n,null,t,e))}}};function B(t){return N.URLTransform(t,N.tokens)}function I(t){var e=t.method;return e||(t.data?"post":"get")}function W(t){for(var e=arguments.length,n=Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var o=Object.assign.apply(Object,[t].concat(n));return delete o[H],o}function G(t,e){var n={};return m.String(t)?(n.url=t,m.PlainObject(e)&&W(n,e),n.method=I(n)):m.PlainObject(t)?(W(n,t),n.method=I(n)):m.Function(t)&&(n[H]=t),m.String(n.dataType)&&""!==n.dataType||(n.dataType="json"),m.String(n.url)&&(n.url=B(n.url)),m.PlainObject(n.data)&&(n.data=Object.entries(n.data).reduce(function(t,e){var n=T(e,2),r=n[1];return t[n[0]]=m.Defined(r)?r:"",t},{})),n}function V(e,n){return function(){var t=n.apply(void 0,arguments);return m.Defined(t)?e(t):e.apply(void 0,arguments)}}function Y(t,e){var n,u=void 0,r=void 0,i=null,o=null,a=null,c=null,s=null,l=[],f=[],d=(j(n={},q,!0),j(n,"then",function(t){o=o?V(t,o):t}),j(n,"catch",function(t){a=a?V(t,a):t}),j(n,"always",function(r){d.then(function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return r(null,e)}),d.catch(function(t){return r(t,null)})}),j(n,"before",function(t){c=c?V(t,c):t}),j(n,"finally",function(t){s=s?V(t,s):t}),j(n,"getXhr",function(){return r?r():l}),j(n,"abort",function(){for(var t=d.getXhr();t.length;)t.pop().abort()}),n);function h(n,o){if(i)if(u){var t=u;u=function(){return t.apply(void 0,arguments).ajax(n||o)}}else{var a=s;u=o?function(){for(var t=arguments.length,r=Array(t),e=0;e<t;e++)r[e]=arguments[e];return o.apply(void 0,r).finally(function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return a.apply(void 0,r.concat(e))})}:function(){for(var t=arguments.length,r=Array(t),e=0;e<t;e++)r[e]=arguments[e];return Y(n).finally(function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return a.apply(void 0,r.concat(e))})},s=null}else f.push(n||o)}function p(t){l.splice(l.indexOf(t),1)}function y(){return f.reduce(function(t,e){var r,o,n,a=void 0;if(m.Function(e)){var i=e();b(P(i),"Hope: Function of ajax() expecting a ajax-object be returned."),a=i.getXhr()[0].always(function(){return p(a)})}else a=(r=e,o=void 0,n=F.of(function(t,e){var n=J(t,e,r);o=S(r).then(n(!0)).catch(n(!1)).abort}),n.abort=o,n).always(function(){return p(a)});return t.push(a),t},l)}function v(t){b(P(t),"Hope: Function of ajax() expecting a ajax-object be returned."),r=t.getXhr}return["ajax","get","post","put","delete"].forEach(function(r){d[r]=w(function(t){return e=t,n="ajax"===r?t.method:r,(e.url?(h(Object.assign(e,{method:n})),1):e[H]&&(h(null,e[H]),1))?d:g(d,["ajax","get","post","put","delete"]);var e,n},G)}),["then","catch","before","always","finally"].forEach(function(t){var e=d[t];d[t]=function(t){return t&&e(t),function(){if(!i){var t=y();c&&c.apply(void 0,O(t)),i=F.all(t).then(function(){var t=void 0;o&&(t=o.apply(void 0,arguments)),u&&(m.Defined(t)?v(u(t)):v(u.apply(void 0,arguments)))}).catch(function(t){a&&a(1===t.length?t[0]:t)}).then(function(){s&&s.apply(void 0,arguments)})}}(),d}}),["ajax","get","post","put","delete","before","then","catch","always","finally"].forEach(function(r){var o=d[r];d[r]=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return u?(function(o){for(var t=arguments.length,n=Array(1<t?t-1:0),e=1;e<t;e++)n[e-1]=arguments[e];var a=u,r=["ajax","get","post","put","delete","then","always","finally"].includes(o),i=1===n.length&&m.Function(n[0])&&r?function(t){var e;return[(e=n[0]).bind.apply(e,[void 0].concat(O(t)))]}:function(){return n};u=function(){for(var t,e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=a.apply(void 0,n))[o].apply(t,O(i(n)))}}.apply(void 0,[r].concat(e)),d):o.apply(void 0,e)}}),d.success=d.done=d.then,d.error=d.fail=d.catch,d.ajax(t,e)}return Object.assign(Y,g(N,["setURLTokens","setURLAlias","setDataTransform","setAssert"]),{getURL:B}),Y});
